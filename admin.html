<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ â€” ë¼ë””ì˜¤ ì‚¬ì—°í•¨</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Mono:wght@400;500&family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.umd.min.js"></script>
<style>
:root{
  --bg:#080c10; --surface:#0d1117; --card:#111820;
  --border:#1e2a38; --border2:#243040;
  --cyan:#00d4ff; --cyan-dim:#0099bb;
  --green:#00e676; --amber:#ffc107; --red:#ff4d4d;
  --text:#e0eaf4; --muted:#5a7a9a; --faint:#2a3a4a;
  --accent:#0066ff;
}
*{margin:0;padding:0;box-sizing:border-box;}
body{font-family:'Noto Sans KR',sans-serif;background:var(--bg);color:var(--text);min-height:100vh;display:flex;flex-direction:column;}

/* â”€â”€â”€ ë¡œê·¸ì¸ í™”ë©´ â”€â”€â”€ */
.login-screen{
  display:flex; align-items:center; justify-content:center;
  min-height:100vh; flex-direction:column; gap:2rem;
  background:radial-gradient(ellipse at 50% 0%, rgba(0,102,255,0.15) 0%, transparent 60%);
}
.login-box{
  background:var(--card); border:1px solid var(--border);
  border-radius:16px; padding:2.5rem; width:90%; max-width:380px;
  text-align:center;
}
.login-box .lock{font-size:2.5rem;margin-bottom:1rem;}
.login-box h2{font-size:1.2rem;font-weight:700;margin-bottom:0.4rem;}
.login-box p{font-size:0.82rem;color:var(--muted);margin-bottom:1.5rem;}
.login-box input{
  width:100%; background:var(--surface); border:1px solid var(--border);
  border-radius:8px; padding:0.8rem 1rem; color:var(--text);
  font-family:'DM Mono',monospace; font-size:1rem; outline:none;
  text-align:center; letter-spacing:0.3em; margin-bottom:1rem;
  transition:border-color 0.2s;
}
.login-box input:focus{border-color:var(--cyan);}
.login-btn{
  width:100%; padding:0.85rem; background:var(--cyan); color:#000;
  border:none; border-radius:8px; font-weight:700; cursor:pointer;
  font-family:'Noto Sans KR',sans-serif; font-size:0.95rem; transition:all 0.2s;
}
.login-btn:hover{background:var(--cyan-dim);}
.login-error{color:var(--red);font-size:0.82rem;margin-top:0.5rem;display:none;}

/* â”€â”€â”€ ì•± ë ˆì´ì•„ì›ƒ â”€â”€â”€ */
.app{display:none;flex:1;}
.sidebar{
  width:220px; background:var(--surface); border-right:1px solid var(--border);
  position:fixed; top:0; left:0; height:100vh; overflow-y:auto;
  display:flex; flex-direction:column; z-index:50;
}
.sidebar-logo{
  padding:1.5rem; border-bottom:1px solid var(--border);
  font-family:'DM Mono',monospace; font-size:0.85rem; color:var(--cyan);
  letter-spacing:0.08em;
}
.sidebar-logo span{display:block;font-size:0.65rem;color:var(--muted);margin-top:0.2rem;letter-spacing:0.15em;}
.nav-item{
  display:flex; align-items:center; gap:0.7rem;
  padding:0.8rem 1.5rem; color:var(--muted); cursor:pointer;
  transition:all 0.2s; font-size:0.88rem; border-left:2px solid transparent;
}
.nav-item:hover{color:var(--text);background:rgba(255,255,255,0.03);}
.nav-item.active{color:var(--cyan);border-left-color:var(--cyan);background:rgba(0,212,255,0.05);}
.nav-section{
  padding:1.2rem 1.5rem 0.4rem;
  font-size:0.65rem; color:var(--faint);
  letter-spacing:0.15em; text-transform:uppercase;
  font-family:'DM Mono',monospace;
}
.sidebar-footer{margin-top:auto;padding:1.5rem;border-top:1px solid var(--border);}
.logout-btn{
  width:100%; padding:0.6rem; background:none; border:1px solid var(--border);
  color:var(--muted); border-radius:6px; cursor:pointer; font-size:0.82rem;
  font-family:'Noto Sans KR',sans-serif; transition:all 0.2s;
}
.logout-btn:hover{border-color:var(--red);color:var(--red);}

/* â”€â”€â”€ ë©”ì¸ ì½˜í…ì¸  â”€â”€â”€ */
.main-content{margin-left:220px;flex:1;padding:2rem;min-height:100vh;}
.page{display:none;}
.page.active{display:block;animation:fadeIn 0.3s ease;}
@keyframes fadeIn{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}

/* â”€â”€â”€ í˜ì´ì§€ í—¤ë” â”€â”€â”€ */
.page-header{
  display:flex;align-items:center;justify-content:space-between;
  margin-bottom:2rem;flex-wrap:wrap;gap:1rem;
}
.page-header h1{font-size:1.4rem;font-weight:700;}
.page-header p{font-size:0.82rem;color:var(--muted);margin-top:0.2rem;}
.action-btns{display:flex;gap:0.6rem;flex-wrap:wrap;}

/* â”€â”€â”€ ë²„íŠ¼ â”€â”€â”€ */
.btn{
  display:inline-flex;align-items:center;gap:0.4rem;
  padding:0.6rem 1.2rem;border-radius:7px;border:1px solid transparent;
  font-family:'Noto Sans KR',sans-serif;font-size:0.85rem;
  cursor:pointer;transition:all 0.2s;font-weight:500;
}
.btn-cyan{background:var(--cyan);color:#000;}
.btn-cyan:hover{background:var(--cyan-dim);}
.btn-ghost{background:none;border-color:var(--border);color:var(--muted);}
.btn-ghost:hover{border-color:var(--border2);color:var(--text);}
.btn-red{background:rgba(255,77,77,0.1);border-color:rgba(255,77,77,0.3);color:var(--red);}
.btn-red:hover{background:rgba(255,77,77,0.2);}
.btn:disabled{opacity:0.4;cursor:not-allowed;}

/* â”€â”€â”€ í†µê³„ ì¹´ë“œ â”€â”€â”€ */
.stats-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:1rem;margin-bottom:2rem;}
.stat-card{
  background:var(--card);border:1px solid var(--border);border-radius:12px;
  padding:1.2rem;position:relative;overflow:hidden;
}
.stat-card::before{
  content:'';position:absolute;top:0;left:0;right:0;height:2px;
}
.stat-card.c1::before{background:var(--cyan);}
.stat-card.c2::before{background:var(--green);}
.stat-card.c3::before{background:var(--amber);}
.stat-card.c4::before{background:var(--accent);}
.stat-label{font-size:0.75rem;color:var(--muted);margin-bottom:0.5rem;font-family:'DM Mono',monospace;letter-spacing:0.05em;}
.stat-num{font-family:'DM Mono',monospace;font-size:2rem;font-weight:500;color:var(--text);}
.stat-sub{font-size:0.72rem;color:var(--muted);margin-top:0.3rem;}

/* â”€â”€â”€ ì°¨íŠ¸ ê·¸ë¦¬ë“œ â”€â”€â”€ */
.charts-grid{display:grid;grid-template-columns:1fr 1fr;gap:1rem;margin-bottom:2rem;}
.chart-card{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:1.2rem;}
.chart-card h3{font-size:0.78rem;color:var(--muted);margin-bottom:1rem;font-family:'DM Mono',monospace;letter-spacing:0.08em;text-transform:uppercase;}
.chart-wrap{position:relative;height:200px;}

/* â”€â”€â”€ í•„í„°/ê²€ìƒ‰ ë°” â”€â”€â”€ */
.toolbar{
  display:flex;gap:0.6rem;margin-bottom:1rem;flex-wrap:wrap;align-items:center;
}
.search-input{
  flex:1;min-width:200px;background:var(--card);border:1px solid var(--border);
  border-radius:7px;padding:0.6rem 1rem;color:var(--text);
  font-family:'Noto Sans KR',sans-serif;font-size:0.85rem;outline:none;
  transition:border-color 0.2s;
}
.search-input:focus{border-color:var(--cyan);}
.filter-chip{
  padding:0.4rem 0.9rem;border-radius:6px;border:1px solid var(--border);
  background:var(--card);color:var(--muted);font-size:0.8rem;
  cursor:pointer;transition:all 0.2s;white-space:nowrap;
}
.filter-chip:hover{color:var(--text);}
.filter-chip.active{background:rgba(0,212,255,0.1);border-color:var(--cyan);color:var(--cyan);}

/* â”€â”€â”€ í…Œì´ë¸” â”€â”€â”€ */
.table-wrap{background:var(--card);border:1px solid var(--border);border-radius:12px;overflow:hidden;}
table{width:100%;border-collapse:collapse;}
thead tr{background:var(--surface);border-bottom:1px solid var(--border);}
th{padding:0.8rem 1rem;text-align:left;font-size:0.72rem;color:var(--muted);font-family:'DM Mono',monospace;letter-spacing:0.08em;text-transform:uppercase;white-space:nowrap;}
td{padding:0.9rem 1rem;font-size:0.85rem;border-bottom:1px solid var(--border);vertical-align:middle;}
tr:last-child td{border-bottom:none;}
tr:hover td{background:rgba(255,255,255,0.02);cursor:pointer;}
.td-name{font-weight:600;color:var(--text);}
.td-text{color:var(--muted);max-width:220px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;}
.td-time{font-family:'DM Mono',monospace;font-size:0.75rem;color:var(--muted);white-space:nowrap;}

/* â”€â”€â”€ ë±ƒì§€ â”€â”€â”€ */
.badge{display:inline-block;padding:0.15rem 0.5rem;border-radius:4px;font-size:0.7rem;font-weight:700;white-space:nowrap;}
.b-text{background:rgba(0,102,255,0.15);color:#6699ff;}
.b-voice{background:rgba(255,77,77,0.15);color:#ff8080;}
.b-cat{background:rgba(255,193,7,0.1);color:var(--amber);}
.b-emo{background:rgba(0,230,118,0.1);color:var(--green);}
.b-ai{background:rgba(0,212,255,0.1);color:var(--cyan);}

/* â”€â”€â”€ í‚¤ì›Œë“œ â”€â”€â”€ */
.kw-grid{display:flex;flex-wrap:wrap;gap:0.5rem;}
.kw-chip{
  padding:0.3rem 0.8rem;border-radius:6px;
  background:var(--card);border:1px solid var(--border);
  font-size:0.82rem;display:flex;align-items:center;gap:0.4rem;
}
.kw-count{background:var(--cyan);color:#000;border-radius:4px;padding:0.05rem 0.4rem;font-size:0.7rem;font-weight:700;font-family:'DM Mono',monospace;}

/* â”€â”€â”€ ëª¨ë‹¬ â”€â”€â”€ */
.overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.7);z-index:200;align-items:center;justify-content:center;backdrop-filter:blur(6px);}
.overlay.open{display:flex;}
.modal{background:var(--card);border:1px solid var(--border);border-radius:16px;width:90%;max-width:600px;max-height:85vh;overflow-y:auto;animation:fadeIn 0.3s ease;}
.modal-header{
  padding:1.5rem; border-bottom:1px solid var(--border);
  display:flex;justify-content:space-between;align-items:flex-start;
  position:sticky;top:0;background:var(--card);z-index:1;
}
.modal-header h3{font-size:1.1rem;font-weight:700;}
.modal-header .badges{display:flex;gap:0.4rem;flex-wrap:wrap;margin-top:0.4rem;}
.close-btn{background:none;border:none;color:var(--muted);font-size:1.1rem;cursor:pointer;padding:0.2rem;transition:color 0.2s;}
.close-btn:hover{color:var(--text);}
.modal-body{padding:1.5rem;}
.story-full{font-size:0.95rem;line-height:1.85;white-space:pre-wrap;color:var(--text);background:var(--surface);border-radius:8px;padding:1rem;}
.modal-footer{padding:1rem 1.5rem;border-top:1px solid var(--border);display:flex;justify-content:space-between;align-items:center;}
.meta-text{font-size:0.75rem;color:var(--muted);font-family:'DM Mono',monospace;}
.ai-result-box{background:rgba(0,212,255,0.05);border:1px solid rgba(0,212,255,0.2);border-radius:8px;padding:0.8rem;margin-top:1rem;}
.ai-result-box .ai-label{font-size:0.7rem;color:var(--cyan);font-family:'DM Mono',monospace;letter-spacing:0.1em;text-transform:uppercase;margin-bottom:0.3rem;}

/* â”€â”€â”€ ë¹ˆ ìƒíƒœ â”€â”€â”€ */
.empty{text-align:center;padding:4rem 2rem;color:var(--muted);}
.empty .icon{font-size:2.5rem;margin-bottom:1rem;}

/* â”€â”€â”€ ìŠ¤í”¼ë„ˆ â”€â”€â”€ */
.spinner{display:inline-block;width:14px;height:14px;border:2px solid rgba(0,0,0,0.3);border-top-color:#000;border-radius:50%;animation:spin 0.7s linear infinite;}
@keyframes spin{to{transform:rotate(360deg)}}

/* â”€â”€â”€ í† ìŠ¤íŠ¸ â”€â”€â”€ */
.toast{position:fixed;bottom:2rem;right:2rem;background:var(--card);border:1px solid var(--border);color:var(--text);padding:0.8rem 1.2rem;border-radius:8px;font-size:0.85rem;opacity:0;transition:all 0.3s;z-index:300;pointer-events:none;transform:translateY(10px);}
.toast.show{opacity:1;transform:translateY(0);}

@media(max-width:900px){
  .sidebar{width:180px;}
  .main-content{margin-left:180px;}
  .stats-grid{grid-template-columns:repeat(2,1fr);}
  .charts-grid{grid-template-columns:1fr;}
}
/* ëª¨ë°”ì¼ í–„ë²„ê±° */
.mobile-header{display:none;position:fixed;top:0;left:0;right:0;height:52px;background:var(--surface);border-bottom:1px solid var(--border);z-index:60;align-items:center;padding:0 1rem;gap:0.8rem;}
.hamburger{background:none;border:none;color:var(--text);font-size:1.3rem;cursor:pointer;padding:0.3rem;}
.mobile-title{font-family:'DM Mono',monospace;font-size:0.85rem;color:var(--cyan);}
.sidebar-overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.7);z-index:58;}
.sidebar-overlay.open{display:block;}
@media(max-width:640px){
  .sidebar{
    display:flex;
    position:fixed;top:0;left:0;height:100vh;
    z-index:59;
    transform:translateX(-100%);
    transition:transform 0.3s ease;
    width:240px;
  }
  .sidebar.open{transform:translateX(0);}
  .main-content{margin-left:0;padding:1rem;padding-top:68px;}
  .mobile-header{display:flex;}
  .stats-grid{grid-template-columns:repeat(2,1fr);}
  .charts-grid{grid-template-columns:1fr;}
}
</style>
</head>
<body>

<!-- â•â• ë¡œê·¸ì¸ â•â• -->
<div class="login-screen" id="login-screen">
  <div class="login-box">
    <div class="lock">ğŸ”</div>
    <h2>ê´€ë¦¬ì ë¡œê·¸ì¸</h2>
    <p>ë¼ë””ì˜¤ ì‚¬ì—°í•¨ ê´€ë¦¬ì ì „ìš© í˜ì´ì§€ì…ë‹ˆë‹¤</p>
    <input type="password" id="pw-input" placeholder="ë¹„ë°€ë²ˆí˜¸" onkeydown="if(event.key==='Enter')doLogin()">
    <button class="login-btn" onclick="doLogin()">ë¡œê·¸ì¸</button>
    <p class="login-error" id="login-error">ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤</p>
  </div>
  <p style="font-size:0.75rem;color:var(--muted);">ê¸°ë³¸ ë¹„ë°€ë²ˆí˜¸: <code style="color:var(--cyan);">radio1234</code></p>
</div>

<!-- â•â• ì•± â•â• -->
<div class="app" id="app" style="display:flex;">

<div class="mobile-header" id="mobile-header">
  <button class="hamburger" onclick="toggleSidebar()">â˜°</button>
  <span class="mobile-title">ğŸ“» RADIO ADMIN</span>
</div>
<div class="sidebar-overlay" id="sidebar-overlay" onclick="toggleSidebar()"></div>

  <aside class="sidebar">
    <div class="sidebar-logo">
      ğŸ“» RADIO ADMIN
      <span>ì‚¬ì—° ê´€ë¦¬ ì‹œìŠ¤í…œ</span>
    </div>
    <div class="nav-section">ë©”ë‰´</div>
    <div class="nav-item active" onclick="showPage('dashboard',this)">ğŸ“Š ëŒ€ì‹œë³´ë“œ</div>
    <div class="nav-item" onclick="showPage('stories',this)">ğŸ“‹ ì‚¬ì—° ëª©ë¡</div>
    <div class="nav-item" onclick="showPage('analysis',this)">ğŸ” ë¶„ì„</div>
    <div class="sidebar-footer">
      <button class="logout-btn" onclick="logout()">ë¡œê·¸ì•„ì›ƒ</button>
    </div>
  </aside>

  <div class="main-content">

    <!-- ëŒ€ì‹œë³´ë“œ -->
    <div class="page active" id="page-dashboard">
      <div class="page-header">
        <div>
          <h1>ëŒ€ì‹œë³´ë“œ</h1>
          <p id="dash-updated">ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: â€”</p>
        </div>
        <div class="action-btns">
          <button class="btn btn-cyan" onclick="loadAll()">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>
          <button class="btn btn-ghost" onclick="downloadExcel()">ğŸ“¥ ì—‘ì…€ ë‹¤ìš´ë¡œë“œ</button>
        </div>
      </div>
      <div class="stats-grid">
        <div class="stat-card c1"><div class="stat-label">TOTAL</div><div class="stat-num" id="st-total">-</div><div class="stat-sub">ì „ì²´ ì‚¬ì—°</div></div>
        <div class="stat-card c2"><div class="stat-label">TEXT</div><div class="stat-num" id="st-text">-</div><div class="stat-sub">í…ìŠ¤íŠ¸ ì‚¬ì—°</div></div>
        <div class="stat-card c3"><div class="stat-label">VOICE</div><div class="stat-num" id="st-voice">-</div><div class="stat-sub">ìŒì„± ì‚¬ì—°</div></div>
        <div class="stat-card c4"><div class="stat-label">TODAY</div><div class="stat-num" id="st-today">-</div><div class="stat-sub">ì˜¤ëŠ˜ ì ‘ìˆ˜</div></div>
      </div>
      <div class="charts-grid">
        <div class="chart-card"><h3>ì¹´í…Œê³ ë¦¬ ë¶„í¬</h3><div class="chart-wrap"><canvas id="chart-cat"></canvas></div></div>
        <div class="chart-card"><h3>ê°ì • íƒœê·¸ TOP 8</h3><div class="chart-wrap"><canvas id="chart-emo"></canvas></div></div>
        <div class="chart-card"><h3>ì¼ë³„ ì ‘ìˆ˜ ì¶”ì´ (ìµœê·¼ 7ì¼)</h3><div class="chart-wrap"><canvas id="chart-daily"></canvas></div></div>
        <div class="chart-card"><h3>ì‚¬ì—° ìœ í˜•</h3><div class="chart-wrap"><canvas id="chart-type"></canvas></div></div>
      </div>
    </div>

    <!-- ì‚¬ì—° ëª©ë¡ -->
    <div class="page" id="page-stories">
      <div class="page-header">
        <div><h1>ì‚¬ì—° ëª©ë¡</h1><p id="story-count">-</p></div>
        <div class="action-btns">
          <button class="btn btn-ghost" onclick="downloadExcel()">ğŸ“¥ ì—‘ì…€</button>
          <button class="btn btn-red" onclick="clearAll()">ì „ì²´ ì‚­ì œ</button>
        </div>
      </div>
      <div class="toolbar">
        <input class="search-input" id="search-input" placeholder="ğŸ” ì´ë¦„, ë‚´ìš© ê²€ìƒ‰..." oninput="renderTable()">
        <span class="filter-chip active" onclick="setFilter('ì „ì²´',this)">ì „ì²´</span>
        <span class="filter-chip" onclick="setFilter('í…ìŠ¤íŠ¸',this)">í…ìŠ¤íŠ¸</span>
        <span class="filter-chip" onclick="setFilter('ìŒì„±',this)">ìŒì„±</span>
        <span class="filter-chip" onclick="setFilter('ğŸ’ ì‚¬ë‘/ì—°ì• ',this)">ğŸ’ ì‚¬ë‘</span>
        <span class="filter-chip" onclick="setFilter('ğŸ‘¨â€ğŸ‘©â€ğŸ‘§ ê°€ì¡±',this)">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§ ê°€ì¡±</span>
        <span class="filter-chip" onclick="setFilter('ğŸŒ¿ ê±´ê°•/ë§ˆìŒ',this)">ğŸŒ¿ ê±´ê°•</span>
      </div>
      <div class="table-wrap">
        <table>
          <thead>
            <tr>
              <th>ì´ë¦„</th><th>ì¹´í…Œê³ ë¦¬</th><th>ê°ì •</th><th>ë‚´ìš© ë¯¸ë¦¬ë³´ê¸°</th><th>ìœ í˜•</th><th>ì ‘ìˆ˜ì¼ì‹œ</th>
            </tr>
          </thead>
          <tbody id="story-tbody">
            <tr><td colspan="6"><div class="empty"><div class="icon">â³</div><p>ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p></div></td></tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- ë¶„ì„ -->
    <div class="page" id="page-analysis">
      <div class="page-header">
        <div><h1>ë¶„ì„</h1><p>ì‚¬ì—° ë°ì´í„° ì‹¬ì¸µ ë¶„ì„</p></div>
        <button class="btn btn-cyan" id="ai-btn" onclick="runAI()">ğŸ¤– AI ê°ì • ë¶„ë¥˜ ì‹¤í–‰</button>
      </div>
      <div class="chart-card" style="margin-bottom:1rem;">
        <h3>ìì£¼ ë“±ì¥í•˜ëŠ” ë‹¨ì–´ TOP 30</h3>
        <div class="kw-grid" id="kw-grid" style="margin-top:0.5rem;">
          <p style="color:var(--muted);font-size:0.85rem;">ì‚¬ì—° ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
        </div>
      </div>
      <div class="chart-card">
        <h3>AI ê°ì • ìë™ ë¶„ë¥˜ ê²°ê³¼</h3>
        <p style="font-size:0.82rem;color:var(--muted);margin-bottom:1rem;">ìƒë‹¨ ë²„íŠ¼ìœ¼ë¡œ AI ë¶„ì„ì„ ì‹¤í–‰í•˜ë©´ ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</p>
        <div id="ai-results"></div>
      </div>
    </div>

  </div>
</div>

<!-- ëª¨ë‹¬ -->
<div class="overlay" id="overlay" onclick="maybeClose(event)">
  <div class="modal">
    <div class="modal-header">
      <div>
        <h3 id="m-name"></h3>
        <div class="badges" id="m-badges"></div>
      </div>
      <button class="close-btn" onclick="closeModal()">âœ•</button>
    </div>
    <div class="modal-body">
      <div id="m-text-area"></div>
      <div id="m-audio-area"></div>
      <div id="m-ai-area"></div>
    </div>
    <div class="modal-footer">
      <p class="meta-text" id="m-time"></p>
      <button class="btn btn-red" onclick="deleteStory()" style="font-size:0.8rem;padding:0.5rem 1rem;">ğŸ—‘ï¸ ì‚­ì œ</button>
    </div>
  </div>
</div>

<div class="toast" id="toast"></div>

<script>
// â”€â”€â”€ ë¹„ë°€ë²ˆí˜¸ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const ADMIN_PW = 'radio1234';
let isLoggedIn = false;

function doLogin(){
  const pw = document.getElementById('pw-input').value;
  if(pw === ADMIN_PW){
    isLoggedIn = true;
    document.getElementById('login-screen').style.display = 'none';
    document.getElementById('app').style.display = 'flex';
    loadAll();
  } else {
    document.getElementById('login-error').style.display = 'block';
    document.getElementById('pw-input').value = '';
    document.getElementById('pw-input').focus();
  }
}
function logout(){
  isLoggedIn = false;
  document.getElementById('login-screen').style.display = 'flex';
  document.getElementById('app').style.display = 'none';
}

// í˜ì´ì§€ ë¡œë“œ ì‹œ ë¡œê·¸ì¸ ì²´í¬
window.onload = () => {
  document.getElementById('app').style.display = 'none';
  document.getElementById('pw-input').focus();
};

function toggleSidebar(){
  document.querySelector('.sidebar').classList.toggle('open');
  document.getElementById('sidebar-overlay').classList.toggle('open');
}

// â”€â”€â”€ ë„¤ë¹„ê²Œì´ì…˜ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function showPage(id, el){
  document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
  document.querySelectorAll('.nav-item').forEach(n=>n.classList.remove('active'));
  document.getElementById('page-'+id).classList.add('active');
  el.classList.add('active');
  // ëª¨ë°”ì¼ì—ì„œ ë©”ë‰´ ì„ íƒ í›„ ì‚¬ì´ë“œë°” ë‹«ê¸°
  document.querySelector('.sidebar').classList.remove('open');
  document.getElementById('sidebar-overlay').classList.remove('open');
  if(id==='analysis') renderKeywords();
}

function showToast(msg){
  const t=document.getElementById('toast');
  t.textContent=msg; t.classList.add('show');
  setTimeout(()=>t.classList.remove('show'),2500);
}

// â”€â”€â”€ ë°ì´í„° â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let allStories=[], activeFilter='ì „ì²´';
let charts={};

async function loadAll(){
  await loadStats();
  await loadStories();
  renderCharts();
  renderKeywords();
  document.getElementById('dash-updated').textContent='ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: '+new Date().toLocaleTimeString('ko-KR');
}

async function loadStats(){
  try{
    const r=await fetch('/api/stats');
    const d=await r.json();
    document.getElementById('st-total').textContent=d.total;
    document.getElementById('st-text').textContent=d.textCount;
    document.getElementById('st-voice').textContent=d.voiceCount;
    document.getElementById('st-today').textContent=d.todayCount;
  }catch(e){}
}

async function loadStories(){
  try{
    const r=await fetch('/api/stories?limit=500');
    const {items}=await r.json();
    allStories=items;
    renderTable();
  }catch(e){
    document.getElementById('story-tbody').innerHTML='<tr><td colspan="6"><div class="empty"><div class="icon">âš ï¸</div><p>ì„œë²„ ì—°ê²° ì‹¤íŒ¨</p></div></td></tr>';
  }
}

// â”€â”€â”€ í…Œì´ë¸” ë Œë”ë§ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderTable(){
  const q=(document.getElementById('search-input').value||'').toLowerCase();
  let list=allStories.filter(s=>{
    if(activeFilter==='í…ìŠ¤íŠ¸') return s.text&&!s.hasVoice;
    if(activeFilter==='ìŒì„±') return s.hasVoice;
    if(activeFilter!=='ì „ì²´') return s.category===activeFilter;
    return true;
  }).filter(s=>{
    if(!q) return true;
    return (s.name||'').toLowerCase().includes(q)||(s.text||'').toLowerCase().includes(q);
  });

  document.getElementById('story-count').textContent=`ì´ ${list.length}ê±´`;
  const tbody=document.getElementById('story-tbody');
  if(!list.length){
    tbody.innerHTML='<tr><td colspan="6"><div class="empty"><div class="icon">ğŸ“­</div><p>ì‚¬ì—°ì´ ì—†ìŠµë‹ˆë‹¤</p></div></td></tr>';
    return;
  }
  tbody.innerHTML=list.map(s=>{
    const d=new Date(s.timestamp);
    const t=d.toLocaleDateString('ko-KR')+' '+d.toLocaleTimeString('ko-KR',{hour:'2-digit',minute:'2-digit'});
    const emos=(s.emotions||[]).slice(0,2).map(e=>`<span class="badge b-emo">${e}</span>`).join('');
    const aiB=s.aiEmotion?`<span class="badge b-ai">ğŸ¤–${s.aiEmotion}</span>`:'';
    return `<tr onclick="openModal('${s.id}')">
      <td class="td-name">${s.name}</td>
      <td>${s.category?`<span class="badge b-cat">${s.category}</span>`:'-'}</td>
      <td>${emos}${aiB}</td>
      <td class="td-text">${s.text||(s.hasVoice?'(ìŒì„± ì‚¬ì—°)':'-')}</td>
      <td>${s.text?`<span class="badge b-text">í…ìŠ¤íŠ¸</span>`:''}${s.hasVoice?`<span class="badge b-voice">ìŒì„±</span>`:''}</td>
      <td class="td-time">${t}</td>
    </tr>`;
  }).join('');
}

function setFilter(val,el){
  activeFilter=val;
  document.querySelectorAll('.filter-chip').forEach(c=>c.classList.remove('active'));
  el.classList.add('active'); renderTable();
}

// â”€â”€â”€ ì°¨íŠ¸ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderCharts(){
  if(!allStories.length) return;
  const C=['#00d4ff','#ffc107','#00e676','#ff4d4d','#a78bfa','#fb923c','#34d399','#f472b6'];

  const cm={};
  allStories.forEach(s=>{if(s.category) cm[s.category]=(cm[s.category]||0)+1;});
  mkDoughnut('chart-cat',Object.keys(cm),Object.values(cm),C);

  const em={};
  allStories.forEach(s=>(s.emotions||[]).forEach(e=>{em[e]=(em[e]||0)+1;}));
  const es=Object.entries(em).sort((a,b)=>b[1]-a[1]).slice(0,8);
  mkBar('chart-emo',es.map(e=>e[0]),es.map(e=>e[1]),'#00d4ff');

  const dm={};
  allStories.forEach(s=>{const d=new Date(s.timestamp).toLocaleDateString('ko-KR');dm[d]=(dm[d]||0)+1;});
  const ds=Object.entries(dm).sort((a,b)=>new Date(a[0])-new Date(b[0])).slice(-7);
  mkLine('chart-daily',ds.map(d=>d[0]),ds.map(d=>d[1]));

  const tc=allStories.filter(s=>s.text&&!s.hasVoice).length;
  const vc=allStories.filter(s=>s.hasVoice&&!s.text).length;
  const bc=allStories.filter(s=>s.text&&s.hasVoice).length;
  mkDoughnut('chart-type',['í…ìŠ¤íŠ¸ë§Œ','ìŒì„±ë§Œ','í…ìŠ¤íŠ¸+ìŒì„±'],[tc,vc,bc],['#00d4ff','#ff4d4d','#ffc107']);
}

function mkDoughnut(id,labels,data,colors){
  if(charts[id]) charts[id].destroy();
  charts[id]=new Chart(document.getElementById(id),{type:'doughnut',data:{labels,datasets:[{data,backgroundColor:colors,borderWidth:0}]},options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{position:'bottom',labels:{color:'#5a7a9a',font:{size:10},boxWidth:10}}}}});
}
function mkBar(id,labels,data,color){
  if(charts[id]) charts[id].destroy();
  charts[id]=new Chart(document.getElementById(id),{type:'bar',data:{labels,datasets:[{data,backgroundColor:color+'33',borderColor:color,borderWidth:1,borderRadius:4}]},options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{display:false}},scales:{x:{ticks:{color:'#5a7a9a',font:{size:10}}},y:{ticks:{color:'#5a7a9a',stepSize:1},grid:{color:'#1e2a38'}}}}});
}
function mkLine(id,labels,data){
  if(charts[id]) charts[id].destroy();
  charts[id]=new Chart(document.getElementById(id),{type:'line',data:{labels,datasets:[{data,borderColor:'#00d4ff',backgroundColor:'rgba(0,212,255,0.08)',tension:0.4,fill:true,pointBackgroundColor:'#00d4ff',pointRadius:4}]},options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{display:false}},scales:{x:{ticks:{color:'#5a7a9a',font:{size:10}}},y:{ticks:{color:'#5a7a9a',stepSize:1},grid:{color:'#1e2a38'}}}}});
}

// â”€â”€â”€ í‚¤ì›Œë“œ ë¶„ì„ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderKeywords(){
  const stop=new Set(['ì´','ê°€','ì„','ë¥¼','ì€','ëŠ”','ì—','ì˜','ë¡œ','ìœ¼ë¡œ','ë„','ì™€','ê³¼','ì—ì„œ','í•œ','í•˜','ì´ë‹¤','ìˆë‹¤','ì—†ë‹¤','ê·¸','ê·¸ë¦¬ê³ ','í•˜ì§€ë§Œ','ê·¸ëŸ°ë°','ë•Œ','ë”','ìˆ˜','ê²ƒ','ë“¤','ì•ˆ','ëª»','ë„ˆ','ë‚˜','ìš°ë¦¬','ì €','ì œ','í•©ë‹ˆë‹¤','í–ˆìŠµë‹ˆë‹¤','ì…ë‹ˆë‹¤','ìŠµë‹ˆë‹¤','í–ˆì–´','ì´ì•¼','í•´ìš”','í•´ì„œ','í•˜ê³ ','í–ˆê³ ','ì¸ë°','ì§€ë§Œ','ë‹ˆê¹Œ','ì—ìš”','ê±°ì•¼','í• ','í•˜ë©´','ìˆì–´','ì—†ì–´','ê°™ì•„','ì¢€','ì •ë§','ë„ˆë¬´','ì§„ì§œ','ì•„ì£¼','ë§¤ìš°','ë§ì´','ì¡°ê¸ˆ','í•­ìƒ','ê³„ì†','ë‹¤ì‹œ','ë˜','ë•Œë¬¸ì—']);
  const freq={};
  allStories.forEach(s=>{
    if(!s.text) return;
    s.text.replace(/[^\w\sã„±-ã…ê°€-í£]/g,' ').split(/\s+/).forEach(w=>{
      if(w.length>=2&&!stop.has(w)) freq[w]=(freq[w]||0)+1;
    });
  });
  const sorted=Object.entries(freq).sort((a,b)=>b[1]-a[1]).slice(0,30);
  const grid=document.getElementById('kw-grid');
  if(!sorted.length){grid.innerHTML='<p style="color:var(--muted);font-size:0.85rem;">í…ìŠ¤íŠ¸ ì‚¬ì—°ì´ ì—†ìŠµë‹ˆë‹¤.</p>';return;}
  const max=sorted[0][1];
  grid.innerHTML=sorted.map(([w,c])=>{
    const size=0.78+(c/max)*0.45;
    return `<span class="kw-chip" style="font-size:${size}rem"><span>${w}</span><span class="kw-count">${c}</span></span>`;
  }).join('');
}

// â”€â”€â”€ AI ë¶„ë¥˜ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function runAI(){
  const texts=allStories.filter(s=>s.text);
  if(!texts.length){showToast('â— ë¶„ì„í•  í…ìŠ¤íŠ¸ ì‚¬ì—°ì´ ì—†ìŠµë‹ˆë‹¤.');return;}
  const btn=document.getElementById('ai-btn');
  btn.disabled=true; btn.innerHTML='<div class="spinner"></div> ë¶„ì„ ì¤‘...';
  const rules=[
    ['ìŠ¬í””',['ìŠ¬í”„','ëˆˆë¬¼','ìš¸','í˜ë“¤','ê´´ë¡œ','ì™¸ë¡œ','ê·¸ë¦½','ì•„í”„','ìƒì²˜','í›„íšŒ','ë¯¸ì•ˆ','ìƒ','ë– ë‚˜','í—¤ì–´','ì´ë³„']],
    ['ê¸°ì¨',['ê¸°ì˜','í–‰ë³µ','ì¢‹ì•„','ì›ƒ','ì¦ê²','ì‹ ë‚˜','ì„¤ë ˆ','ê°ì‚¬','ê³ ë§ˆ','ì‚¬ë‘','ì˜ë','ë‹¤í–‰']],
    ['ë¶„ë…¸',['í™”ë‚˜','ì§œì¦','ì—´ë°›','ì‹«','ì–µìš¸','ë¶ˆê³µí‰','í™”ê°€','ë¶„í•˜','ë¯¸ì›Œ','ì›ë§']],
    ['ë¶ˆì•ˆ',['ê±±ì •','ë¶ˆì•ˆ','ë‘ë ¤','ë¬´ì„­','ê¸´ì¥','ì´ˆì¡°','ë–¨ë¦¬','ê²ë‚˜','ì–´ì©Œ','ëª¨ë¥´ê² ']],
    ['í¬ë§',['í¬ë§','ë°”ë¼','ê¸°ëŒ€','ê¿ˆ','ì•ìœ¼ë¡œ','ë‚˜ì•„ì§€','ì´ê²¨','ê·¹ë³µ','í•  ìˆ˜ ìˆ','ë…¸ë ¥']],
    ['ê°ì‚¬',['ê°ì‚¬','ê³ ë§ˆ','ë•ë¶„','ë°°ë ¤','ì±™ê²¨','ì‘ì›','í˜ì´','ìœ„ë¡œ','ë„ì›€']],
  ];
  const results=[];
  texts.slice(0,50).forEach(s=>{
    const sc={};
    rules.forEach(([e,w])=>{sc[e]=w.filter(k=>s.text.includes(k)).length;});
    const top=Object.entries(sc).sort((a,b)=>b[1]-a[1])[0];
    s.aiEmotion=top&&top[1]>0?top[0]:'ì¤‘ë¦½';
    results.push(s);
  });
  btn.disabled=false; btn.innerHTML='ğŸ¤– AI ê°ì • ë¶„ë¥˜ ì‹¤í–‰';
  showToast(`âœ… ${results.length}ê°œ ì‚¬ì—° ë¶„ì„ ì™„ë£Œ`);
  document.getElementById('ai-results').innerHTML=results.slice(0,20).map(s=>`
    <div style="background:var(--surface);border:1px solid var(--border);border-radius:8px;padding:0.9rem;margin-bottom:0.6rem;display:flex;gap:0.8rem;align-items:flex-start;">
      <span class="badge b-ai" style="flex-shrink:0;margin-top:2px;">ğŸ¤– ${s.aiEmotion}</span>
      <div>
        <span style="font-weight:600;font-size:0.85rem;">${s.name}</span>
        <p style="font-size:0.82rem;color:var(--muted);margin-top:0.2rem;">${s.text.slice(0,100)}${s.text.length>100?'...':''}</p>
      </div>
    </div>`).join('');
  renderTable();
}

// â”€â”€â”€ ì—‘ì…€ ë‹¤ìš´ë¡œë“œ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function downloadExcel(){
  if(!allStories.length){showToast('â— ì‚¬ì—°ì´ ì—†ìŠµë‹ˆë‹¤.');return;}
  const rows=allStories.map(s=>({
    'ë²ˆí˜¸':s.id.slice(0,8),'ì´ë¦„':s.name,'ì—°ë½ì²˜':s.contact||'',
    'ì¹´í…Œê³ ë¦¬':s.category||'','ê°ì •íƒœê·¸':(s.emotions||[]).join(', '),
    'AIê°ì •ë¶„ë¥˜':s.aiEmotion||'','ì‚¬ì—°ë‚´ìš©':s.text||'(ìŒì„±ì‚¬ì—°)',
    'ìŒì„±ì—¬ë¶€':s.hasVoice?'O':'X',
    'ì ‘ìˆ˜ì¼ì‹œ':new Date(s.timestamp).toLocaleString('ko-KR')
  }));
  const ws=XLSX.utils.json_to_sheet(rows);
  ws['!cols']=[{wch:10},{wch:12},{wch:18},{wch:14},{wch:20},{wch:12},{wch:50},{wch:8},{wch:20}];
  const wb=XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb,ws,'ì‚¬ì—°ëª©ë¡');
  const date=new Date().toLocaleDateString('ko-KR').replace(/\. /g,'-').replace('.','');
  XLSX.writeFile(wb,`ë¼ë””ì˜¤ì‚¬ì—°_${date}.xlsx`);
  showToast('âœ… ì—‘ì…€ ë‹¤ìš´ë¡œë“œ ì™„ë£Œ');
}

async function clearAll(){
  if(!confirm('ëª¨ë“  ì‚¬ì—°ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
  await fetch('/api/stories',{method:'DELETE'});
  showToast('âœ… ì „ì²´ ì‚­ì œ ì™„ë£Œ'); allStories=[]; loadAll();
}

// â”€â”€â”€ ëª¨ë‹¬ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let currentId=null;
function openModal(id){
  const s=allStories.find(x=>x.id===id); if(!s) return;
  currentId=id;
  document.getElementById('m-name').textContent=s.name+'ë‹˜ì˜ ì‚¬ì—°';
  document.getElementById('m-badges').innerHTML=[
    s.category?`<span class="badge b-cat">${s.category}</span>`:'',
    ...(s.emotions||[]).map(e=>`<span class="badge b-emo">${e}</span>`),
    s.aiEmotion?`<span class="badge b-ai">ğŸ¤– ${s.aiEmotion}</span>`:''
  ].join('');
  document.getElementById('m-text-area').innerHTML=s.text?`<div class="story-full">${s.text}</div>`:'';
  document.getElementById('m-audio-area').innerHTML=s.voiceUrl?`<audio controls preload="none" src="${s.voiceUrl}" style="width:100%;margin-top:1rem;border-radius:8px;"></audio>`:'';
  document.getElementById('m-ai-area').innerHTML=s.aiEmotion?`<div class="ai-result-box"><div class="ai-label">AI ê°ì • ë¶„ë¥˜ ê²°ê³¼</div><p style="font-size:0.9rem;">${s.aiEmotion}</p></div>`:'';
  const d=new Date(s.timestamp);
  let meta=d.toLocaleString('ko-KR');
  if(s.contact) meta+=' Â· '+s.contact;
  document.getElementById('m-time').textContent=meta;
  document.getElementById('overlay').classList.add('open');
}
async function deleteStory(){
  if(!currentId||!confirm('ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
  await fetch(`/api/stories/${currentId}`,{method:'DELETE'});
  allStories=allStories.filter(s=>s.id!==currentId);
  closeModal(); showToast('âœ… ì‚­ì œ ì™„ë£Œ'); renderTable();
}
function maybeClose(e){if(e.target===document.getElementById('overlay')) closeModal();}
function closeModal(){document.getElementById('overlay').classList.remove('open');currentId=null;}
</script>
</body>
</html>
