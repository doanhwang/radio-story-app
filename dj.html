<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DJ ìŠ¤íŠœë””ì˜¤ â€” ë¼ë””ì˜¤ ì‚¬ì—°í•¨</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Mono:wght@400;500&family=Noto+Sans+KR:wght@300;400;500;700&family=Playfair+Display:ital,wght@0,700;1,400&display=swap" rel="stylesheet">
<style>
:root {
  --bg: #06080d;
  --surface: #0c0f18;
  --card: #111622;
  --card2: #161c2e;
  --border: #1e2740;
  --border2: #2a3555;
  --gold: #f0c060;
  --gold-dim: #c8982a;
  --gold-pale: rgba(240,192,96,0.08);
  --cyan: #4fc8e8;
  --green: #50e8a0;
  --red: #f06060;
  --purple: #a080f0;
  --text: #dde6f5;
  --muted: #5a6a8a;
  --faint: #1e2a3a;
}

* { margin:0; padding:0; box-sizing:border-box; }
html { scroll-behavior:smooth; }
body {
  font-family:'Noto Sans KR', sans-serif;
  background:var(--bg); color:var(--text);
  min-height:100vh;
}

/* â”€â”€ ë¡œê·¸ì¸ â”€â”€ */
.login-screen {
  display:flex; align-items:center; justify-content:center;
  min-height:100vh; flex-direction:column; gap:2rem;
  background:radial-gradient(ellipse at 50% 0%, rgba(240,192,96,0.1) 0%, transparent 60%);
}
.login-box {
  background:var(--card); border:1px solid var(--border);
  border-radius:16px; padding:2.5rem; width:90%; max-width:360px; text-align:center;
}
.login-box .icon { font-size:2.5rem; margin-bottom:1rem; }
.login-box h2 { font-size:1.15rem; font-weight:700; margin-bottom:0.3rem; }
.login-box p { font-size:0.82rem; color:var(--muted); margin-bottom:1.5rem; }
.login-box input {
  width:100%; background:var(--surface); border:1px solid var(--border);
  border-radius:8px; padding:0.8rem 1rem; color:var(--text);
  font-family:'DM Mono',monospace; font-size:1rem; outline:none;
  text-align:center; letter-spacing:0.3em; margin-bottom:1rem;
}
.login-box input:focus { border-color:var(--gold); }
.login-btn {
  width:100%; padding:0.85rem; background:var(--gold); color:#000;
  border:none; border-radius:8px; font-weight:700; cursor:pointer;
  font-family:'Noto Sans KR',sans-serif; font-size:0.95rem;
}
.login-btn:hover { background:var(--gold-dim); }
.login-error { color:var(--red); font-size:0.82rem; margin-top:0.5rem; display:none; }

/* â”€â”€ ì•± ë ˆì´ì•„ì›ƒ â”€â”€ */
.app { display:none; min-height:100vh; }

/* â”€â”€ í—¤ë” â”€â”€ */
.header {
  background:var(--surface); border-bottom:1px solid var(--border);
  padding:0 2rem; height:56px;
  display:flex; align-items:center; justify-content:space-between;
  position:sticky; top:0; z-index:100;
}
.header-logo {
  font-family:'DM Mono',monospace; font-size:0.9rem; color:var(--gold);
  display:flex; align-items:center; gap:0.7rem;
}
.on-air {
  display:flex; align-items:center; gap:0.4rem;
  font-size:0.7rem; letter-spacing:0.15em; color:var(--red);
  font-family:'DM Mono',monospace;
}
.on-dot { width:7px; height:7px; background:var(--red); border-radius:50%; animation:pulse 1.5s infinite; }
@keyframes pulse { 0%,100%{opacity:1} 50%{opacity:0.3} }
.header-actions { display:flex; gap:0.6rem; }

/* â”€â”€ ë©”ì¸ â”€â”€ */
.main { display:grid; grid-template-columns:400px 1fr; min-height:calc(100vh - 56px); }

/* â”€â”€ ì‚¬ì—° íŒ¨ë„ (ì¢Œ) â”€â”€ */
.panel-left {
  background:var(--surface); border-right:1px solid var(--border);
  display:flex; flex-direction:column; height:calc(100vh - 56px);
  position:sticky; top:56px;
}
.panel-title {
  padding:1.2rem 1.5rem; border-bottom:1px solid var(--border);
  font-size:0.75rem; font-family:'DM Mono',monospace;
  color:var(--muted); letter-spacing:0.12em; text-transform:uppercase;
  display:flex; align-items:center; justify-content:space-between;
}
.story-list { flex:1; overflow-y:auto; padding:0.6rem; }
.story-card {
  background:var(--card); border:1px solid var(--border);
  border-radius:10px; padding:1rem; margin-bottom:0.5rem;
  cursor:pointer; transition:all 0.2s;
}
.story-card:hover { border-color:var(--border2); background:var(--card2); }
.story-card.selected { border-color:var(--gold); background:var(--gold-pale); }
.story-card-header {
  display:flex; align-items:center; justify-content:space-between;
  margin-bottom:0.5rem;
}
.story-name { font-weight:600; font-size:0.88rem; }
.story-type-badge {
  font-size:0.65rem; padding:0.15rem 0.5rem; border-radius:4px;
  font-family:'DM Mono',monospace; font-weight:700;
}
.t-self   { background:rgba(160,128,240,0.15); color:#c0a8ff; }
.t-parent { background:rgba(80,232,160,0.15);  color:#80f0b8; }
.t-helper { background:rgba(79,200,232,0.15);  color:#80d8f0; }
.t-care   { background:rgba(240,192,96,0.15);  color:#f0c878; }
.story-preview {
  font-size:0.8rem; color:var(--muted); line-height:1.5;
  overflow:hidden; display:-webkit-box; -webkit-line-clamp:2; -webkit-box-orient:vertical;
}
.story-meta {
  display:flex; gap:0.5rem; margin-top:0.5rem; flex-wrap:wrap;
}
.tag-mini {
  font-size:0.68rem; padding:0.1rem 0.45rem; border-radius:4px;
  background:var(--faint); color:var(--muted);
}
.empty-list { text-align:center; padding:3rem 1rem; color:var(--muted); font-size:0.85rem; }

/* â”€â”€ ê²€ìƒ‰ / í•„í„° â”€â”€ */
.list-toolbar { padding:0.8rem; border-bottom:1px solid var(--border); }
.search-box {
  width:100%; background:var(--card); border:1px solid var(--border);
  border-radius:7px; padding:0.55rem 0.9rem; color:var(--text);
  font-family:'Noto Sans KR',sans-serif; font-size:0.82rem; outline:none;
}
.search-box:focus { border-color:var(--gold); }
.filter-row { display:flex; gap:0.4rem; margin-top:0.5rem; flex-wrap:wrap; }
.fchip {
  font-size:0.72rem; padding:0.2rem 0.6rem; border-radius:5px;
  border:1px solid var(--border); background:var(--card); color:var(--muted);
  cursor:pointer; transition:all 0.15s;
}
.fchip:hover { color:var(--text); }
.fchip.on { border-color:var(--gold); color:var(--gold); background:var(--gold-pale); }

/* â”€â”€ ìŠ¤íŠœë””ì˜¤ íŒ¨ë„ (ìš°) â”€â”€ */
.panel-right { padding:2rem; overflow-y:auto; }

.studio-empty {
  display:flex; flex-direction:column; align-items:center; justify-content:center;
  min-height:60vh; color:var(--muted); text-align:center; gap:1rem;
}
.studio-empty .big-icon { font-size:4rem; opacity:0.3; }
.studio-empty p { font-size:0.9rem; line-height:1.7; }

/* ì„ íƒëœ ì‚¬ì—° ìš”ì•½ */
.selected-story-box {
  background:var(--card); border:1px solid var(--border);
  border-radius:14px; padding:1.5rem; margin-bottom:1.5rem;
  border-left:3px solid var(--gold);
}
.selected-story-box h3 {
  font-family:'Playfair Display',serif; font-size:1.1rem;
  color:var(--gold); margin-bottom:0.8rem;
}
.selected-story-text {
  font-size:0.88rem; line-height:1.85; color:var(--text);
  white-space:pre-wrap; max-height:200px; overflow-y:auto;
}
.selected-story-meta { margin-top:0.8rem; display:flex; gap:0.5rem; flex-wrap:wrap; }

/* DJ ì„¤ì • */
.dj-config {
  background:var(--card); border:1px solid var(--border);
  border-radius:14px; padding:1.5rem; margin-bottom:1.5rem;
}
.config-title {
  font-size:0.72rem; font-family:'DM Mono',monospace;
  color:var(--muted); letter-spacing:0.12em; text-transform:uppercase;
  margin-bottom:1rem;
}
.config-grid { display:grid; grid-template-columns:1fr 1fr; gap:0.8rem; }
.config-field label {
  display:block; font-size:0.75rem; color:var(--muted); margin-bottom:0.3rem;
}
.config-field select, .config-field input {
  width:100%; background:var(--surface); border:1px solid var(--border);
  border-radius:7px; padding:0.55rem 0.8rem; color:var(--text);
  font-family:'Noto Sans KR',sans-serif; font-size:0.82rem; outline:none;
}
.config-field select:focus, .config-field input:focus { border-color:var(--gold); }

/* ìƒì„± ë²„íŠ¼ */
.generate-btn {
  width:100%; padding:1rem; margin-bottom:1.5rem;
  background:linear-gradient(135deg, var(--gold), var(--gold-dim));
  color:#000; border:none; border-radius:12px;
  font-family:'Noto Sans KR',sans-serif; font-size:1rem; font-weight:700;
  cursor:pointer; transition:all 0.25s; letter-spacing:0.03em;
  display:flex; align-items:center; justify-content:center; gap:0.6rem;
}
.generate-btn:hover { filter:brightness(1.1); transform:translateY(-1px); box-shadow:0 6px 24px rgba(240,192,96,0.3); }
.generate-btn:disabled { opacity:0.4; cursor:not-allowed; transform:none; box-shadow:none; }

/* ë°©ì†¡ ìŠ¤í¬ë¦½íŠ¸ */
.broadcast-script { display:none; }
.script-header {
  display:flex; align-items:center; justify-content:space-between;
  margin-bottom:1.2rem; flex-wrap:wrap; gap:0.6rem;
}
.script-header h2 {
  font-family:'Playfair Display',serif; font-size:1.3rem; color:var(--gold);
}
.script-actions { display:flex; gap:0.5rem; }

/* ë°©ì†¡ ì„¹ì…˜ ë¸”ë¡ */
.section-block {
  background:var(--card); border:1px solid var(--border);
  border-radius:12px; margin-bottom:1rem; overflow:hidden;
}
.section-head {
  display:flex; align-items:center; gap:0.8rem;
  padding:0.9rem 1.2rem; border-bottom:1px solid var(--border);
  background:var(--card2);
}
.section-num {
  width:26px; height:26px; border-radius:50%;
  background:var(--gold); color:#000;
  display:flex; align-items:center; justify-content:center;
  font-size:0.72rem; font-weight:700; font-family:'DM Mono',monospace;
  flex-shrink:0;
}
.section-label { font-size:0.78rem; font-weight:700; color:var(--text); }
.section-sublabel { font-size:0.7rem; color:var(--muted); margin-left:auto; font-family:'DM Mono',monospace; }
.section-body { padding:1.2rem; }
.section-content {
  font-size:0.88rem; line-height:1.9; color:var(--text);
  white-space:pre-wrap; min-height:60px;
}
.section-content.loading { color:var(--muted); font-style:italic; }

/* Suno í”„ë¡¬í”„íŠ¸ ë¸”ë¡ */
.suno-block {
  background:rgba(160,128,240,0.06); border:1px solid rgba(160,128,240,0.2);
  border-radius:8px; padding:1rem; margin-top:0.8rem;
}
.suno-label {
  font-size:0.68rem; font-family:'DM Mono',monospace;
  color:var(--purple); letter-spacing:0.12em; text-transform:uppercase;
  margin-bottom:0.5rem; display:flex; align-items:center; gap:0.4rem;
}
.suno-prompt {
  font-size:0.82rem; color:#c8b8f8; line-height:1.7;
  font-family:'DM Mono',monospace;
}
.suno-copy-btn {
  margin-top:0.6rem; padding:0.3rem 0.8rem;
  background:rgba(160,128,240,0.15); border:1px solid rgba(160,128,240,0.3);
  color:var(--purple); border-radius:5px; font-size:0.75rem;
  cursor:pointer; transition:all 0.2s;
}
.suno-copy-btn:hover { background:rgba(160,128,240,0.25); }

/* ë²„íŠ¼ ê³µí†µ */
.btn {
  display:inline-flex; align-items:center; gap:0.35rem;
  padding:0.5rem 1rem; border-radius:7px; border:1px solid transparent;
  font-family:'Noto Sans KR',sans-serif; font-size:0.82rem;
  cursor:pointer; transition:all 0.2s; font-weight:500;
}
.btn-gold { background:var(--gold); color:#000; border-color:var(--gold); }
.btn-gold:hover { background:var(--gold-dim); }
.btn-ghost { background:none; border-color:var(--border); color:var(--muted); }
.btn-ghost:hover { border-color:var(--border2); color:var(--text); }
.btn-green { background:rgba(80,232,160,0.1); border-color:rgba(80,232,160,0.3); color:var(--green); }
.btn-green:hover { background:rgba(80,232,160,0.2); }

/* ìŠ¤í”¼ë„ˆ */
.spinner {
  width:16px; height:16px; border:2px solid rgba(0,0,0,0.2);
  border-top-color:#000; border-radius:50%; animation:spin 0.7s linear infinite; display:inline-block;
}
.spinner-gold {
  width:16px; height:16px; border:2px solid rgba(240,192,96,0.2);
  border-top-color:var(--gold); border-radius:50%; animation:spin 0.7s linear infinite; display:inline-block;
}
@keyframes spin { to { transform:rotate(360deg) } }

/* í† ìŠ¤íŠ¸ */
.toast {
  position:fixed; bottom:2rem; right:2rem;
  background:var(--card); border:1px solid var(--border);
  color:var(--text); padding:0.7rem 1.1rem; border-radius:8px;
  font-size:0.82rem; opacity:0; transition:all 0.3s;
  z-index:999; pointer-events:none; transform:translateY(10px);
}
.toast.show { opacity:1; transform:translateY(0); }

/* ìŠ¤íŠ¸ë¦¬ë° ì»¤ì„œ */
.cursor { display:inline-block; width:2px; height:1em; background:var(--gold); animation:blink 1s infinite; vertical-align:text-bottom; margin-left:2px; }
@keyframes blink { 0%,100%{opacity:1} 50%{opacity:0} }

/* ì§„í–‰ ë°” */
.progress-bar {
  height:2px; background:var(--border);
  border-radius:1px; margin-bottom:1.5rem; overflow:hidden;
  display:none;
}
.progress-fill {
  height:100%; background:linear-gradient(90deg, var(--gold-dim), var(--gold));
  border-radius:1px; width:0%; transition:width 0.5s ease;
}

/* ë°˜ì‘í˜• */
@media(max-width:900px) {
  .main { grid-template-columns:1fr; }
  .panel-left { height:auto; position:static; max-height:40vh; }
  .config-grid { grid-template-columns:1fr; }
}
</style>
</head>
<body>

<!-- â”€â”€ ë¡œê·¸ì¸ â”€â”€ -->
<div class="login-screen" id="login-screen">
  <div class="login-box">
    <div class="icon">ğŸ™ï¸</div>
    <h2>DJ ìŠ¤íŠœë””ì˜¤</h2>
    <p>ë¼ë””ì˜¤ ì‚¬ì—° ë°©ì†¡ ì œì‘ ì‹œìŠ¤í…œ</p>
    <input type="password" id="pw-input" placeholder="ë¹„ë°€ë²ˆí˜¸" onkeydown="if(event.key==='Enter')doLogin()">
    <button class="login-btn" onclick="doLogin()">ì…ì¥í•˜ê¸°</button>
    <p class="login-error" id="login-error">ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤</p>
  </div>
</div>

<!-- â”€â”€ ì•± â”€â”€ -->
<div class="app" id="app">

  <!-- í—¤ë” -->
  <header class="header">
    <div class="header-logo">
      ğŸ™ï¸ DJ STUDIO
      <div class="on-air"><span class="on-dot"></span> ON AIR</div>
    </div>
    <div class="header-actions">
      <button class="btn btn-ghost" onclick="loadStories()">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>
      <button class="btn btn-ghost" onclick="location.href='/admin'">â† ê´€ë¦¬ì</button>
    </div>
  </header>

  <div class="main">

    <!-- â”€â”€ ì¢Œ: ì‚¬ì—° ëª©ë¡ â”€â”€ -->
    <div class="panel-left">
      <div class="list-toolbar">
        <input class="search-box" id="search-box" placeholder="ğŸ” ì‚¬ì—° ê²€ìƒ‰..." oninput="renderList()">
        <div class="filter-row">
          <span class="fchip on" data-f="ì „ì²´" onclick="setFilter(this)">ì „ì²´</span>
          <span class="fchip" data-f="self" onclick="setFilter(this)">ë‚˜ì˜ì´ì•¼ê¸°</span>
          <span class="fchip" data-f="parent" onclick="setFilter(this)">ë¶€ëª¨</span>
          <span class="fchip" data-f="helper" onclick="setFilter(this)">ì§€ì›ì‚¬</span>
          <span class="fchip" data-f="care" onclick="setFilter(this)">ëŒë´„</span>
        </div>
      </div>
      <div class="panel-title">
        <span>ì‚¬ì—° ëª©ë¡</span>
        <span id="story-count-label">â€”</span>
      </div>
      <div class="story-list" id="story-list">
        <div class="empty-list">â³ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
      </div>
    </div>

    <!-- â”€â”€ ìš°: ìŠ¤íŠœë””ì˜¤ â”€â”€ -->
    <div class="panel-right" id="studio-panel">

      <div class="studio-empty" id="studio-empty">
        <div class="big-icon">ğŸšï¸</div>
        <p>ì™¼ìª½ì—ì„œ ì‚¬ì—°ì„ ì„ íƒí•˜ë©´<br>AI DJê°€ ë§ì¶¤ ë¼ë””ì˜¤ ë°©ì†¡ì„ ì œì‘í•©ë‹ˆë‹¤.</p>
      </div>

      <!-- ì„ íƒëœ ì‚¬ì—° -->
      <div id="studio-content" style="display:none;">

        <div class="selected-story-box" id="selected-story-box">
          <h3 id="sel-name">â€”</h3>
          <div class="selected-story-text" id="sel-text"></div>
          <div class="selected-story-meta" id="sel-meta"></div>
        </div>

        <!-- DJ ì„¤ì • -->
        <div class="dj-config">
          <div class="config-title">ğŸ›ï¸ DJ ë°©ì†¡ ì„¤ì •</div>
          <div class="config-grid">
            <div class="config-field">
              <label>DJ ì´ë¦„</label>
              <input type="text" id="cfg-dj-name" value="DJ ì€í•˜" placeholder="DJ ì´ë¦„">
            </div>
            <div class="config-field">
              <label>ë°©ì†¡ í†¤</label>
              <select id="cfg-tone">
                <option value="ë”°ëœ»í•˜ê³  ê³µê°ì ì¸">ë”°ëœ»í•˜ê³  ê³µê°ì ì¸</option>
                <option value="ë°ê³  ìœ ì¾Œí•œ">ë°ê³  ìœ ì¾Œí•œ</option>
                <option value="ì°¨ë¶„í•˜ê³  ì„œì •ì ì¸">ì°¨ë¶„í•˜ê³  ì„œì •ì ì¸</option>
                <option value="í˜ì°¨ê³  ê²©ë ¤í•˜ëŠ”">í˜ì°¨ê³  ê²©ë ¤í•˜ëŠ”</option>
                <option value="ê°ì„±ì ì´ê³  ì‹œì ì¸">ê°ì„±ì ì´ê³  ì‹œì ì¸</option>
              </select>
            </div>
            <div class="config-field">
              <label>ë°©ì†¡ ì–¸ì–´</label>
              <select id="cfg-lang">
                <option value="í•œêµ­ì–´">í•œêµ­ì–´</option>
                <option value="ì˜ì–´">ì˜ì–´</option>
              </select>
            </div>
            <div class="config-field">
              <label>ìŒì•… ì¥ë¥´</label>
              <select id="cfg-genre">
                <option value="ì”ì”í•œ ì–´ì¿ ìŠ¤í‹±">ì”ì”í•œ ì–´ì¿ ìŠ¤í‹±</option>
                <option value="ê°ì„± íŒ">ê°ì„± íŒ</option>
                <option value="ì¬ì¦ˆ/ë³´ì‚¬ë…¸ë°”">ì¬ì¦ˆ/ë³´ì‚¬ë…¸ë°”</option>
                <option value="í”¼ì•„ë…¸ ë°œë¼ë“œ">í”¼ì•„ë…¸ ë°œë¼ë“œ</option>
                <option value="ì¸ë”” í¬í¬">ì¸ë”” í¬í¬</option>
                <option value="í´ë˜ì‹ í˜„ì•…">í´ë˜ì‹ í˜„ì•…</option>
                <option value="Lo-fi í™í•©">Lo-fi í™í•©</option>
              </select>
            </div>
          </div>
        </div>

        <!-- ì§„í–‰ ë°” -->
        <div class="progress-bar" id="progress-bar">
          <div class="progress-fill" id="progress-fill"></div>
        </div>

        <button class="generate-btn" id="gen-btn" onclick="generateBroadcast()">
          âœ¨ ë¼ë””ì˜¤ ë°©ì†¡ ì œì‘í•˜ê¸°
        </button>

        <!-- ìƒì„±ëœ ë°©ì†¡ ìŠ¤í¬ë¦½íŠ¸ -->
        <div class="broadcast-script" id="broadcast-script">

          <div class="script-header">
            <h2>ğŸ“» ë°©ì†¡ ìŠ¤í¬ë¦½íŠ¸</h2>
            <div class="script-actions">
              <button class="btn btn-ghost" onclick="copyAll()">ğŸ“‹ ì „ì²´ ë³µì‚¬</button>
              <button class="btn btn-green" onclick="generateBroadcast()">ğŸ”„ ì¬ìƒì„±</button>
            </div>
          </div>

          <!-- ì„¹ì…˜ 1: ì¸íŠ¸ë¡œ ìŒì•… -->
          <div class="section-block">
            <div class="section-head">
              <div class="section-num">1</div>
              <div>
                <div class="section-label">ğŸµ ì¸íŠ¸ë¡œ ìŒì•…</div>
              </div>
              <div class="section-sublabel">INTRO MUSIC</div>
            </div>
            <div class="section-body">
              <div class="section-content" id="sc-intro-music"></div>
              <div class="suno-block" id="sb-intro">
                <div class="suno-label">ğŸµ Suno AI í”„ë¡¬í”„íŠ¸</div>
                <div class="suno-prompt" id="sp-intro"></div>
                <button class="suno-copy-btn" onclick="copySuno('sp-intro')">ë³µì‚¬</button>
              </div>
            </div>
          </div>

          <!-- ì„¹ì…˜ 2: ì˜¤í”„ë‹ ë©˜íŠ¸ -->
          <div class="section-block">
            <div class="section-head">
              <div class="section-num">2</div>
              <div>
                <div class="section-label">ğŸ¤ DJ ì˜¤í”„ë‹ ë©˜íŠ¸</div>
              </div>
              <div class="section-sublabel">OPENING</div>
            </div>
            <div class="section-body">
              <div class="section-content" id="sc-opening"></div>
            </div>
          </div>

          <!-- ì„¹ì…˜ 3: ì‚¬ì—° ì†Œê°œ -->
          <div class="section-block">
            <div class="section-head">
              <div class="section-num">3</div>
              <div>
                <div class="section-label">ğŸ’Œ ì‚¬ì—° ì†Œê°œ</div>
              </div>
              <div class="section-sublabel">STORY</div>
            </div>
            <div class="section-body">
              <div class="section-content" id="sc-story"></div>
            </div>
          </div>

          <!-- ì„¹ì…˜ 4: DJ ì†Œê° -->
          <div class="section-block">
            <div class="section-head">
              <div class="section-num">4</div>
              <div>
                <div class="section-label">ğŸ’¬ DJ ì†Œê° & ëª…ì–¸</div>
              </div>
              <div class="section-sublabel">REFLECTION</div>
            </div>
            <div class="section-body">
              <div class="section-content" id="sc-reflection"></div>
            </div>
          </div>

          <!-- ì„¹ì…˜ 5: ì„ ë¬¼ ìŒì•… -->
          <div class="section-block">
            <div class="section-head">
              <div class="section-num">5</div>
              <div>
                <div class="section-label">ğŸ ì‚¬ì—°ìë¥¼ ìœ„í•œ ìŒì•… ì„ ë¬¼</div>
              </div>
              <div class="section-sublabel">GIFT MUSIC</div>
            </div>
            <div class="section-body">
              <div class="section-content" id="sc-gift-music"></div>
              <div class="suno-block" id="sb-gift">
                <div class="suno-label">ğŸµ Suno AI í”„ë¡¬í”„íŠ¸ â€” ë§ì¶¤ ì‘ê³¡</div>
                <div class="suno-prompt" id="sp-gift"></div>
                <button class="suno-copy-btn" onclick="copySuno('sp-gift')">ë³µì‚¬</button>
              </div>
            </div>
          </div>

          <!-- ì„¹ì…˜ 6: í´ë¡œì§• ë©˜íŠ¸ -->
          <div class="section-block">
            <div class="section-head">
              <div class="section-num">6</div>
              <div>
                <div class="section-label">ğŸŒ™ í´ë¡œì§• ë©˜íŠ¸</div>
              </div>
              <div class="section-sublabel">CLOSING</div>
            </div>
            <div class="section-body">
              <div class="section-content" id="sc-closing"></div>
            </div>
          </div>

          <!-- ì„¹ì…˜ 7: í´ë¡œì§• ìŒì•… -->
          <div class="section-block">
            <div class="section-head">
              <div class="section-num">7</div>
              <div>
                <div class="section-label">ğŸµ í´ë¡œì§• ìŒì•…</div>
              </div>
              <div class="section-sublabel">OUTRO MUSIC</div>
            </div>
            <div class="section-body">
              <div class="section-content" id="sc-outro-music"></div>
              <div class="suno-block" id="sb-outro">
                <div class="suno-label">ğŸµ Suno AI í”„ë¡¬í”„íŠ¸</div>
                <div class="suno-prompt" id="sp-outro"></div>
                <button class="suno-copy-btn" onclick="copySuno('sp-outro')">ë³µì‚¬</button>
              </div>
            </div>
          </div>

        </div><!-- /broadcast-script -->
      </div><!-- /studio-content -->
    </div><!-- /panel-right -->
  </div><!-- /main -->
</div><!-- /app -->

<div class="toast" id="toast"></div>

<script>
// â”€â”€ ì¸ì¦ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const ADMIN_PW = 'radio1234';
function doLogin(){
  const pw = document.getElementById('pw-input').value;
  if(pw === ADMIN_PW){
    document.getElementById('login-screen').style.display = 'none';
    document.getElementById('app').style.display = 'block';
    loadStories();
  } else {
    document.getElementById('login-error').style.display = 'block';
  }
}
document.addEventListener('DOMContentLoaded', () => {
  document.getElementById('pw-input').focus();
});

// â”€â”€ ë°ì´í„° â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let allStories = [];
let selectedStory = null;
let activeFilter = 'ì „ì²´';

async function loadStories(){
  try {
    const res = await fetch('/api/stories?limit=200');
    const d = await res.json();
    allStories = (d.items || []).filter(s => s.text && s.text.trim().length > 10);
    document.getElementById('story-count-label').textContent = allStories.length + 'ê±´';
    renderList();
  } catch(e) {
    showToast('â— ì‚¬ì—° ë¡œë“œ ì‹¤íŒ¨');
  }
}

function setFilter(el){
  activeFilter = el.dataset.f;
  document.querySelectorAll('.fchip').forEach(c => c.classList.remove('on'));
  el.classList.add('on');
  renderList();
}

function renderList(){
  const q = document.getElementById('search-box').value.trim().toLowerCase();
  let list = allStories;

  if(activeFilter !== 'ì „ì²´'){
    list = list.filter(s => (s.audience_type || 'self') === activeFilter);
  }
  if(q){
    list = list.filter(s =>
      (s.name||'').toLowerCase().includes(q) ||
      (s.text||'').toLowerCase().includes(q) ||
      (s.category||'').includes(q)
    );
  }

  const el = document.getElementById('story-list');
  if(!list.length){
    el.innerHTML = '<div class="empty-list">ğŸ“­ ì‚¬ì—°ì´ ì—†ìŠµë‹ˆë‹¤</div>';
    return;
  }

  const TYPE_LABELS = {
    self: ['ë‚˜ì˜ì´ì•¼ê¸°','t-self'], parent: ['ë¶€ëª¨','t-parent'],
    helper: ['ì§€ì›ì‚¬','t-helper'], care: ['ëŒë´„','t-care']
  };

  el.innerHTML = list.map(s => {
    const tKey = s.audience_type || 'self';
    const [tLabel, tClass] = TYPE_LABELS[tKey] || ['ê¸°íƒ€','t-self'];
    const emos = (s.emotions || []).slice(0,3).map(e =>
      `<span class="tag-mini">${e}</span>`).join('');
    const isSelected = selectedStory && selectedStory.id === s.id;
    return `<div class="story-card${isSelected?' selected':''}" onclick="selectStory('${s.id}')">
      <div class="story-card-header">
        <span class="story-name">${s.name}</span>
        <span class="story-type-badge ${tClass}">${tLabel}</span>
      </div>
      <div class="story-preview">${s.text}</div>
      <div class="story-meta">
        ${s.category ? `<span class="tag-mini">${s.category}</span>` : ''}
        ${emos}
      </div>
    </div>`;
  }).join('');
}

function selectStory(id){
  selectedStory = allStories.find(s => s.id === id);
  if(!selectedStory) return;

  // UI ì—…ë°ì´íŠ¸
  renderList();
  document.getElementById('studio-empty').style.display = 'none';
  document.getElementById('studio-content').style.display = 'block';
  document.getElementById('broadcast-script').style.display = 'none';

  document.getElementById('sel-name').textContent = selectedStory.name + 'ë‹˜ì˜ ì‚¬ì—°';
  document.getElementById('sel-text').textContent = selectedStory.text;

  const emos = (selectedStory.emotions||[]).map(e=>`<span class="tag-mini">${e}</span>`).join('');
  const cat = selectedStory.category ? `<span class="tag-mini">${selectedStory.category}</span>` : '';
  document.getElementById('sel-meta').innerHTML = cat + emos;

  document.getElementById('studio-panel').scrollTop = 0;
}

// â”€â”€ ë°©ì†¡ ìƒì„± â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function generateBroadcast(){
  if(!selectedStory){ showToast('â— ì‚¬ì—°ì„ ë¨¼ì € ì„ íƒí•´ì£¼ì„¸ìš”'); return; }

  const djName  = document.getElementById('cfg-dj-name').value || 'DJ ì€í•˜';
  const tone    = document.getElementById('cfg-tone').value;
  const lang    = document.getElementById('cfg-lang').value;
  const genre   = document.getElementById('cfg-genre').value;

  const btn = document.getElementById('gen-btn');
  btn.disabled = true;
  btn.innerHTML = '<div class="spinner"></div> AIê°€ ë°©ì†¡ì„ ì œì‘í•˜ê³  ìˆìŠµë‹ˆë‹¤...';

  // ì§„í–‰ ë°” í‘œì‹œ
  const bar = document.getElementById('progress-bar');
  const fill = document.getElementById('progress-fill');
  bar.style.display = 'block';
  fill.style.width = '0%';

  // ìŠ¤í¬ë¦½íŠ¸ ì„¹ì…˜ ì´ˆê¸°í™”
  const ids = ['sc-intro-music','sc-opening','sc-story','sc-reflection','sc-gift-music','sc-closing','sc-outro-music','sp-intro','sp-gift','sp-outro'];
  ids.forEach(id => {
    const el = document.getElementById(id);
    if(el){ el.textContent = ''; el.classList.add('loading'); }
  });

  document.getElementById('broadcast-script').style.display = 'block';
  document.getElementById('studio-panel').scrollTo({ top: 400, behavior:'smooth' });

  const prompt = buildPrompt(selectedStory, djName, tone, lang, genre);

  try {
    const response = await fetch('/api/dj/generate', {
      method:'POST',
      headers:{ 'Content-Type':'application/json' },
      body: JSON.stringify({ prompt })
    });

    // ì„œë²„ ì˜¤ë¥˜ ì²´í¬
    if(!response.ok){
      const errData = await response.json().catch(() => ({}));
      throw new Error(errData.error || 'HTTP ' + response.status);
    }

    let fullText = '';
    let buffer = '';
    const reader = response.body.getReader();
    const decoder = new TextDecoder();

    while(true){
      const { done, value } = await reader.read();
      if(done) break;

      buffer += decoder.decode(value, { stream: true });
      const lines = buffer.split('\n');
      // ë§ˆì§€ë§‰ ë¶ˆì™„ì „í•œ ì¤„ì€ ë²„í¼ì— ë³´ì¡´
      buffer = lines.pop();

      for(const line of lines){
        const trimmed = line.trim();
        if(!trimmed.startsWith('data:')) continue;
        const data = trimmed.slice(5).trim();
        if(data === '[DONE]') continue;
        try {
          const j = JSON.parse(data);
          // ì—ëŸ¬ ì‘ë‹µ ì²˜ë¦¬
          if(j.type === 'error'){
            throw new Error(j.error?.message || 'API ì˜¤ë¥˜');
          }
          if(j.type === 'content_block_delta' && j.delta?.type === 'text_delta'){
            fullText += j.delta.text;
            parseAndRender(fullText);
          }
        } catch(parseErr){
          // JSON íŒŒì‹± ì‹¤íŒ¨ëŠ” ë¬´ì‹œ (ë¶ˆì™„ì „í•œ ì²­í¬)
        }
      }
    }

    if(!fullText){
      throw new Error('AI ì‘ë‹µì´ ë¹„ì–´ ìˆìŠµë‹ˆë‹¤. API í‚¤ì™€ í¬ë ˆë”§ì„ í™•ì¸í•˜ì„¸ìš”.');
    }

    parseAndRender(fullText, true);
    fill.style.width = '100%';
    setTimeout(() => { bar.style.display = 'none'; fill.style.width = '0%'; }, 800);

  } catch(e) {
    showToast('â— ' + e.message);
    console.error('DJ ìƒì„± ì˜¤ë¥˜:', e);
    bar.style.display = 'none';
  }

  btn.disabled = false;
  btn.innerHTML = 'âœ¨ ë¼ë””ì˜¤ ë°©ì†¡ ì œì‘í•˜ê¸°';

  // loading í´ë˜ìŠ¤ ì œê±°
  ids.forEach(id => {
    const el = document.getElementById(id);
    if(el) el.classList.remove('loading');
  });
}

function buildPrompt(story, djName, tone, lang, genre){
  const audienceMap = {
    self: 'ì¥ì• ì¸ ë‹¹ì‚¬ì', parent: 'ì¥ì• ì¸ ìë…€ë¥¼ ë‘” ë¶€ëª¨',
    helper: 'ì¥ì• ì¸ í™œë™ì§€ì›ì‚¬', care: 'ì¹˜ë§¤ ë¶€ëª¨ë¥¼ ëª¨ì‹œëŠ” ìë…€'
  };
  const audience = audienceMap[story.audience_type || 'self'] || 'ì²­ì·¨ì';
  const emotions = (story.emotions||[]).join(', ') || 'ì—†ìŒ';
  const category = story.category || 'ê¸°íƒ€';

  return `ë‹¹ì‹ ì€ ë¼ë””ì˜¤ DJ ${djName}ì…ë‹ˆë‹¤. ì•„ë˜ ì‚¬ì—°ì„ ë°”íƒ•ìœ¼ë¡œ ì™„ì „í•œ ë¼ë””ì˜¤ ë°©ì†¡ í”„ë¡œê·¸ë¨ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‘ì„±í•˜ì„¸ìš”.

[ì‚¬ì—° ì •ë³´]
- ë³´ë‚¸ ë¶„: ${story.name}
- ëŒ€ìƒ ì²­ì·¨ì ê·¸ë£¹: ${audience}
- ì¹´í…Œê³ ë¦¬: ${category}
- ê°ì • íƒœê·¸: ${emotions}
- ì‚¬ì—° ë‚´ìš©:
"""
${story.text}
"""

[ë°©ì†¡ ì„¤ì •]
- DJ ì´ë¦„: ${djName}
- ë°©ì†¡ í†¤: ${tone}
- ì–¸ì–´: ${lang}
- ìŒì•… ì¥ë¥´: ${genre}

ì•„ë˜ í˜•ì‹ì„ ì •í™•íˆ ë”°ë¼ 7ê°œ ì„¹ì…˜ì„ ì‘ì„±í•˜ì„¸ìš”. ê° ì„¹ì…˜ì€ ë°˜ë“œì‹œ [SECTION:ì„¹ì…˜ID] íƒœê·¸ë¡œ ì‹œì‘í•˜ê³  [/SECTION] íƒœê·¸ë¡œ ëë‚´ì„¸ìš”.

[SECTION:intro_music]
(ì¸íŠ¸ë¡œ ìŒì•… ì„¤ëª…: ë°©ì†¡ ì‹œì‘ì„ ì•Œë¦¬ëŠ” ë¶„ìœ„ê¸° ìŒì•…ì— ëŒ€í•œ 2-3ì¤„ ì„¤ëª…)
[SUNO:intro]
(Suno AIë¡œ ì´ ìŒì•…ì„ ë§Œë“¤ê¸° ìœ„í•œ ì˜ì–´ í”„ë¡¬í”„íŠ¸. ì¥ë¥´, ë¶„ìœ„ê¸°, BPM, ì•…ê¸°, ê¸¸ì´ ë“± êµ¬ì²´ì ìœ¼ë¡œ)
[/SUNO]
[/SECTION]

[SECTION:opening]
(DJ ${djName}ì˜ ì˜¤í”„ë‹ ë©˜íŠ¸: ì²­ì·¨ìì—ê²Œ ì˜¤ëŠ˜ ë°©ì†¡ì„ ì†Œê°œí•˜ëŠ” ë”°ëœ»í•œ ì¸ì‚¬ë§. 3-5ë¬¸ì¥)
[/SECTION]

[SECTION:story]
(DJê°€ ì‚¬ì—°ì„ ì²­ì·¨ìì—ê²Œ ì†Œê°œí•˜ëŠ” ë©˜íŠ¸. ì‚¬ì—° ë‚´ìš©ì„ ìì—°ìŠ¤ëŸ½ê²Œ ì†Œê°œí•˜ë˜ ì›ë¬¸ì„ ê·¸ëŒ€ë¡œ ì½ì§€ ë§ê³  DJ ìŠ¤íƒ€ì¼ë¡œ ì „ë‹¬. ê°ì •ì´ì… í¬í•¨. 5-8ë¬¸ì¥)
[/SECTION]

[SECTION:reflection]
(DJì˜ ì†Œê° ë©˜íŠ¸: ì‚¬ì—°ì— ì–´ìš¸ë¦¬ëŠ” ëª…ì–¸, ì˜í™” ëŒ€ì‚¬, ì‹œêµ¬, ë…¸ë˜ ê°€ì‚¬ ë“±ì„ ì¸ìš©í•˜ê³ , ì´ì— ëŒ€í•œ DJì˜ ì§„ì‹¬ ì–´ë¦° ì½”ë©˜íŠ¸. ì¶œì²˜ ëª…ì‹œ. 5-8ë¬¸ì¥)
[/SECTION]

[SECTION:gift_music]
(ì‚¬ì—°ìë¥¼ ìœ„í•´ íŠ¹ë³„íˆ ì‘ê³¡ëœ ìŒì•… ì†Œê°œ ë©˜íŠ¸: ì™œ ì´ ìŒì•…ì„ ì„ ë¬¼í•˜ëŠ”ì§€ ì„¤ëª…. 3-4ë¬¸ì¥)
[SUNO:gift]
(ì‚¬ì—° ë‚´ìš©ê³¼ ê°ì •ì— ì™„ì „íˆ ë§ì¶¤í™”ëœ Suno AI ì‘ê³¡ í”„ë¡¬í”„íŠ¸. ì‚¬ì—°ìì˜ ê°ì •/ìƒí™©ì„ ë°˜ì˜. ì˜ì–´ë¡œ êµ¬ì²´ì ìœ¼ë¡œ ì‘ì„±. ì œëª©, ê°€ì‚¬ ë°©í–¥, ì¥ë¥´, ì•…ê¸° í¸ì„±, ë¶„ìœ„ê¸°, BPM í¬í•¨)
[/SUNO]
[/SECTION]

[SECTION:closing]
(í´ë¡œì§• ë©˜íŠ¸: ì‚¬ì—°ìì™€ ê°™ì€ ìƒí™©ì˜ ëª¨ë“  ì²­ì·¨ìì—ê²Œ ì „í•˜ëŠ” ë”°ëœ»í•œ ë§ˆë¬´ë¦¬ ì¸ì‚¬. í¬ë§ì ì´ê³  ê³µê°ì ì¸ ë©”ì‹œì§€. 4-6ë¬¸ì¥)
[/SECTION]

[SECTION:outro_music]
(í´ë¡œì§• ìŒì•… ì„¤ëª…: ì—¬ìš´ì„ ë‚¨ê¸°ëŠ” ì—”ë”© ìŒì•…ì— ëŒ€í•œ ì„¤ëª…)
[SUNO:outro]
(í´ë¡œì§• ìŒì•…ì„ ìœ„í•œ Suno AI í”„ë¡¬í”„íŠ¸. ì—¬ìš´, ë”°ëœ»í•¨, ë§ˆë¬´ë¦¬ ë¶„ìœ„ê¸°. ì˜ì–´ë¡œ)
[/SUNO]
[/SECTION]

ëª¨ë“  ë©˜íŠ¸ëŠ” ì‹¤ì œ ë°©ì†¡ì—ì„œ ì½ì„ ìˆ˜ ìˆëŠ” ìì—°ìŠ¤ëŸ¬ìš´ í•œêµ­ì–´ë¡œ ì‘ì„±í•˜ì„¸ìš”. ì§„ì‹¬ì´ ë‹´ê¸°ê³  ê°ë™ì ì´ì–´ì•¼ í•©ë‹ˆë‹¤.`;
}

// â”€â”€ ìŠ¤íŠ¸ë¦¬ë° íŒŒì‹± & ë Œë”ë§ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function parseAndRender(text, isFinal=false){
  const sections = {
    'intro_music': 'sc-intro-music',
    'opening': 'sc-opening',
    'story': 'sc-story',
    'reflection': 'sc-reflection',
    'gift_music': 'sc-gift-music',
    'closing': 'sc-closing',
    'outro_music': 'sc-outro-music',
  };
  const sunoMap = {
    'intro': 'sp-intro',
    'gift': 'sp-gift',
    'outro': 'sp-outro',
  };

  // ê° ì„¹ì…˜ íŒŒì‹±
  for(const [key, elId] of Object.entries(sections)){
    const re = new RegExp(`\\[SECTION:${key}\\]([\\s\\S]*?)(?:\\[/SECTION\\]|$)`, 'i');
    const m = text.match(re);
    if(m){
      const el = document.getElementById(elId);
      if(el){
        // SUNO ë¸”ë¡ ì œê±° í›„ í‘œì‹œ
        let content = m[1].replace(/\[SUNO:[^\]]+\][\s\S]*?\[\/SUNO\]/gi, '').trim();
        el.textContent = content;
        el.classList.remove('loading');
      }
    }
  }

  // Suno í”„ë¡¬í”„íŠ¸ íŒŒì‹±
  for(const [key, elId] of Object.entries(sunoMap)){
    const re = new RegExp(`\\[SUNO:${key}\\]([\\s\\S]*?)\\[/SUNO\\]`, 'i');
    const m = text.match(re);
    if(m){
      const el = document.getElementById(elId);
      if(el){ el.textContent = m[1].trim(); el.classList.remove('loading'); }
    }
  }

  // ì§„í–‰ë¥  ì—…ë°ì´íŠ¸
  const found = Object.keys(sections).filter(k => text.includes(`[SECTION:${k}]`)).length;
  const pct = Math.min(95, (found / 7) * 100);
  document.getElementById('progress-fill').style.width = pct + '%';
}

// â”€â”€ ë³µì‚¬ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function copySuno(id){
  const text = document.getElementById(id).textContent;
  navigator.clipboard.writeText(text).then(() => showToast('âœ… Suno í”„ë¡¬í”„íŠ¸ ë³µì‚¬ë¨'));
}

function copyAll(){
  const sections = [
    'ğŸµ ì¸íŠ¸ë¡œ ìŒì•…', 'sc-intro-music',
    'ğŸ¤ DJ ì˜¤í”„ë‹ ë©˜íŠ¸', 'sc-opening',
    'ğŸ’Œ ì‚¬ì—° ì†Œê°œ', 'sc-story',
    'ğŸ’¬ DJ ì†Œê° & ëª…ì–¸', 'sc-reflection',
    'ğŸ ì„ ë¬¼ ìŒì•…', 'sc-gift-music',
    'ğŸŒ™ í´ë¡œì§• ë©˜íŠ¸', 'sc-closing',
    'ğŸµ í´ë¡œì§• ìŒì•…', 'sc-outro-music',
  ];
  let full = `ğŸ“» ë¼ë””ì˜¤ ë°©ì†¡ ìŠ¤í¬ë¦½íŠ¸\n${'='.repeat(40)}\n\n`;
  for(let i=0; i<sections.length; i+=2){
    const label = sections[i];
    const content = document.getElementById(sections[i+1])?.textContent || '';
    if(content) full += `ã€${label}ã€‘\n${content}\n\n`;
  }
  navigator.clipboard.writeText(full).then(() => showToast('âœ… ì „ì²´ ìŠ¤í¬ë¦½íŠ¸ ë³µì‚¬ë¨'));
}

// â”€â”€ ìœ í‹¸ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function showToast(msg){
  const t = document.getElementById('toast');
  t.textContent = msg; t.classList.add('show');
  setTimeout(() => t.classList.remove('show'), 2500);
}
</script>
</body>
</html>
